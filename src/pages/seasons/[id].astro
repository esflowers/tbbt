---
import { name } from '../../data';
import { seasons } from '../../data/seasons';
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/Button.astro';
import InfoLine from '../../components/InfoLine.astro';
import IconChevronL from '../../components/icons/IconChevronL.astro';
import IconChevronR from '../../components/icons/IconChevronR.astro';
import IconCoffee from '../../components/icons/IconCoffee.astro';
import IconStar from '../../components/icons/IconStar.astro';

export async function getStaticPaths () {
    return seasons.map(season => ({
        params: { id: season.number },
        props: { season }
    }))
}

const { season } = Astro.props;

const index = seasons.findIndex(s => s.number === season.number);
const prev = index > 0 ? seasons[index - 1] : null;
const next = index < seasons.length - 1 ? seasons[index + 1] : null;
---

<Layout page={`${season.title} - ${name}`}>
	<nav slot="nav" class="w-full -mt-6 mb-10 text-sm grid grid-cols-3 gap-3 md:gap-0">
		{index === 0 ? (
			<Button text="Inicio" link="/" title="Ir al inicio" className="md:ml-auto uppercase">
				<IconChevronL slot="l" size="13" />
			</Button>
		) : (
			prev && (
				<Button text="Anterior" link={prev.link} title={prev.title} className="md:ml-auto uppercase">
					<IconChevronL slot="l" size="13" />
				</Button>
			)
		)}
		<h2 class="font-extrabold uppercase text-center tracking-tight text-base-800">{season.title}</h2>
		{index === seasons.length - 1 ? (
			<Button text="Inicio" link="/" title="Ir al inicio" className="ml-auto md:ml-0 md:mr-auto uppercase">
				<IconChevronR slot="r" size="13" />
			</Button>
		) : (
			next && (
				<Button text="Siguiente" link={next.link} title={next.title} className="ml-auto md:ml-0 md:mr-auto uppercase">
					<IconChevronR slot="r" size="13" />
				</Button>
			)
		)}
	</nav>

	<div slot="article" class="space-y-2 text-sm order-2">
		<div set:html={season.description} class="space-y-2 font-medium text-base-950"></div>
		<br>
		<div class="space-y-1.5 text-base-900">
			<InfoLine title='Episodios'>
				<span class="font-mono">{season.nEpisodes}</span>
			</InfoLine>
			<InfoLine title='Inicio'>
				<time datetime={season.start}>{season.start}</time>
			</InfoLine>
			<InfoLine title='Final'>
				<time datetime={season.end}>{season.end}</time>
			</InfoLine>
		</div>
		<br>
	</div>

	{season.episodes.length > 0 ? 
		<menu class="w-full space-y-2 lg:columns-2 lg:gap-x-4">
			{season.episodes.map (item => (
				<Button text={item.title} link={item.link} type='block' title={`${item.title}, ${season.title} - ${name}`}>
					<span slot="l" class="min-w-[3ch] font-mono text-end">{item.number}.</span>
					<div slot='r' class="w-fit ml-auto flex items-center gap-2">
						<span class="hidden xl:flex font-mono text-xs opacity-0 transition duration-150 group-hover:opacity-100">{item.release}</span>
						<IconChevronR size='13' />
					</div>
				</Button>
			))}
		</menu>
		: <h2 class="font-display text-3xl text-base-900">En desarrollo...</h2>
	}
</Layout>